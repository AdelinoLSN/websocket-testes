<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <div>
        <button id="Enviar">Enviar</button>
    </div>
</body>

<!-- <script src="parte1.js"></script> -->

<!-- <script src="https://cdn.socket.io/4.6.0/socket.io.min.js" integrity="sha384-c79GN5VsunZvi+Q/WObgk2in0CbZsHnjEqvFxC5DxHn9lTfNce2WW6h2pH6u/kF+" crossorigin="anonymous"></script> -->
<!-- <script src="http://localhost:8080/socket.io/socket.io.js"></script> -->
<!-- <script src="gio.js"></script> -->
<!-- <script src="app.js"></script> -->
<script>
    // SharedWorker
    const sharedWorker = new SharedWorker('parte2.js');
    sharedWorker.port.onmessage = (event) => {
        console.log('index: onmessage', event.data);
    };

    // Button
    const btnEnviar = document.getElementById('Enviar');
    btnEnviar.addEventListener('click', () => {
        if (sharedWorker) sharedWorker.port.postMessage('Chegando');
    });

    // setInterval(() => {
    //     // socket.emit('message', 'Hello from socket ' + Date.now());
    //     if (sharedWorker) {
    //         sharedWorker.port.postMessage('Hello from socket ' + Date.now());
    //     }
    // }, 1000);

    // function connectIoIndex() {
    //     io = io.connect('http://localhost:3000');

    //     io.on('connect', function() {
    //         console.log('Connected to server');
    //     });
    // }

    // connectIoIndex();

    // const socketIo = io('http://localhost:3000');
    // socketIo.on('connect', () => {
    //     console.log('conectado');

    //     socketIo.emit('join', '2121');
    // });


    // sharedWorker.port.onmessage = (event) => {
    //     console.log('index: onmessage', event.data);
    // };

    // var worker = new SharedWorker('sharedWorker.js', 'http://localhost:3000');

    // var gio = function (uri, onConnect, onDisconnect) {
    //     console.log('gio');
    //     console.log(uri);
    //     console.log(onConnect);
    //     console.log(onDisconnect);

    //     var worker = {};
    //     var onError = {};
    //     var workerUri = {};
    //     var events = {};

    //     function getKeys(obj) {
    //         console.log('getKeys');
    //         console.log(obj);

    //         var keys = [];

    //         for (var key in obj) {
    //             if (obj.hasOwnProperty(key)) {
    //                 keys.push(key);
    //             }
    //         }

    //         return keys;
    //     }

    //     function onMessage(type, message) {
    //         console.log('onMessage');
    //         console.log(type);
    //         console.log(message);

    //         switch (type) {
    //             case '_connect':
    //                 if (onConnect) onConnect();
    //                 break;
    //             case '_disconnect':
    //                 if (onDisconnect) onDisconnect();
    //                 break;
    //             default:
    //                 if (events[type]) events[type](message);
    //         }
    //     }

    //     function startWorker() {
    //         console.log('startWorker');

    //         worker = new SharedWorker(workerUri, uri);

    //         worker.port.addEventListener('message', (event) => {
    //             onMessage(event.data.type, event.data.data);
    //         });

    //         worker.onerror = (event) => {
    //             if (onError) onError(event);
    //         };

    //         worker.port.start();
    //         worker.port.postMessage({ events: getKeys(events) });
    //     }

    //     function startSocketIo() {
    //         console.log('startSocketIo');

    //         var socket = io(uri);

    //         socket.on('connect', () => {
    //             if (onConnect) onConnect();
    //         });

    //         socket.on('disconnect', () => {
    //             if (onDisconnect) onDisconnect();
    //         });

    //         for (const eventName in events) {
    //             if (events.hasOwnProperty(eventName)) {
    //                 socket.on(eventName, socketOnEventHandler(eventName));
    //             }
    //         }
    //     }

    //     function socketOnEventHandler(eventName) {
    //         console.log('socketOnEventHandler');
    //         console.log(eventName);

    //         return (data) => {
    //             events[eventName](data);
    //         };
    //     }

    //     return {
    //         registerEvent: (eventName, callback) => {
    //             console.log('registerEvent');

    //             events[eventName] = callback;
    //         },
    //         start: () => {
    //             console.log('start');
    //             console.log(SharedWorker);
    //             if (!SharedWorker) startSocketIo();
    //             else startWorker();
    //         },
    //         onError: (callback) => {
    //             console.log('onError');
    //             console.log(callback);

    //             onError = callback;
    //         },
    //         setWorker: (uri) => {
    //             console.log('setWorker');
    //             console.log(uri);

    //             workerUri = uri;
    //         }
    //     };
    // }

    // function iniciar(gio) {
    //     console.log('iniciar');
    //     console.log(gio);

    //     var onConnect = function () {
    //         console.log('connected');
    //     };

    //     var onDisconnect = function () {
    //         console.log('disconnected');
    //     };

    //     var ws = gio('http://localhost:3000', onConnect, onDisconnect);
    //     console.log('ws');
    //     console.log(ws);
    //     ws.setWorker('sharedWorker.js');
    //     console.log(ws);

    //     ws.registerEvent('message', (message) => {
    //         console.log('message');
    //         console.log(message);
    //     });

    //     ws.onError((event) => {
    //         console.log('error');
    //         console.log(event);
    //     });

    //     ws.start();
    // }

    // iniciar(gio);
</script>

</html>